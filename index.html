<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Monitoring System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .dashboard-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .alert-theft {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 2rem;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { background-color: rgba(255, 0, 0, 0.9); }
            50% { background-color: rgba(200, 0, 0, 0.9); }
            100% { background-color: rgba(255, 0, 0, 0.9); }
        }
        .reading-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .unit {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .bill-table {
            font-size: 0.9rem;
        }
        .nav-tabs .nav-link.active {
            font-weight: bold;
            border-bottom: 3px solid #0d6efd;
        }
        .theft-log {
            max-height: 300px;
            overflow-y: auto;
        }
        .consumer-bg {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }
        .admin-bg {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="login-container text-center">
                    <h2 class="mb-4"><i class="fas fa-bolt text-warning"></i> Power Monitoring System</h2>
                    <div class="mb-4">
                        <img src="https://cdn-icons-png.flaticon.com/512/3627/3627088.png" alt="Energy Icon" width="100">
                    </div>
                    <div class="mb-3">
                        <input type="text" id="username" class="form-control" placeholder="User ID">
                    </div>
                    <div class="mb-3">
                        <input type="password" id="password" class="form-control" placeholder="Password">
                    </div>
                    <button id="login-btn" class="btn btn-primary w-100">Login</button>
                    <div class="mt-3">
                        <p class="text-muted">Demo Accounts:<br>
                            Consumer: house111 / house111<br>
                            Admin: admin111 / admin111
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Consumer Dashboard -->
    <div id="consumer-dashboard" class="container-fluid d-none consumer-bg">
        <div class="dashboard-container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-home text-primary"></i> Consumer Dashboard - House111</h2>
                <button id="consumer-logout" class="btn btn-outline-secondary">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Current Power Readings</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="text-muted">Voltage</div>
                                    <div class="reading-value"><span id="consumer-voltage">0.00</span> <span class="unit">V</span></div>
                                </div>
                                <div class="col-6">
                                    <div class="text-muted">Current</div>
                                    <div class="reading-value"><span id="consumer-current">0.00</span> <span class="unit">A</span></div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="text-muted">Power</div>
                                    <div class="reading-value"><span id="consumer-power">0.00</span> <span class="unit">W</span></div>
                                </div>
                                <div class="col-6">
                                    <div class="text-muted">Energy</div>
                                    <div class="reading-value"><span id="consumer-energy">0.00</span> <span class="unit">kWh</span></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-muted">Frequency</div>
                                    <div class="reading-value"><span id="consumer-frequency">0.00</span> <span class="unit">Hz</span></div>
                                </div>
                                <div class="col-6">
                                    <div class="text-muted">Power Factor</div>
                                    <div class="reading-value"><span id="consumer-pf">0.00</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Bill Information</h5>
                        </div>
                        <div class="card-body text-center">
                            <button id="calculate-bill" class="btn btn-warning mb-3">
                                <i class="fas fa-file-invoice-dollar"></i> Calculate Bill
                            </button>
                            <div id="bill-details" class="d-none">
                                <h5>Last Two Months Consumption</h5>
                                <table class="table bill-table">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th>Energy (kWh)</th>
                                            <th>Amount (₹)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Previous Month</td>
                                            <td id="prev-month-energy">120</td>
                                            <td id="prev-month-amount">594.00</td>
                                        </tr>
                                        <tr>
                                            <td>Current Month</td>
                                            <td id="current-month-energy">95</td>
                                            <td id="current-month-amount">470.25</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="alert alert-info">
                                    <small>Tariff: 0-200 units ₹4.95/unit, 401-500 units ₹11.05/unit</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Historical Data</h5>
                </div>
                <div class="card-body">
                    <canvas id="consumer-chart" height="100"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="container-fluid d-none admin-bg">
        <div class="dashboard-container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-user-cog text-danger"></i> Admin Dashboard</h2>
                <button id="admin-logout" class="btn btn-outline-secondary">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="monitoring-tab" data-bs-toggle="tab" data-bs-target="#monitoring" type="button" role="tab">Power Monitoring</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="theft-log-tab" data-bs-toggle="tab" data-bs-target="#theft-log" type="button" role="tab">Theft Log</button>
                </li>
            </ul>

            <div class="tab-content" id="adminTabContent">
                <div class="tab-pane fade show active" id="monitoring" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">Distribution Transformer (Board 1)</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="text-muted">Voltage</div>
                                            <div class="reading-value"><span id="transformer-voltage">0.00</span> <span class="unit">V</span></div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-muted">Current</div>
                                            <div class="reading-value"><span id="transformer-current">0.00</span> <span class="unit">A</span></div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="text-muted">Power</div>
                                            <div class="reading-value"><span id="transformer-power">0.00</span> <span class="unit">W</span></div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-muted">Energy</div>
                                            <div class="reading-value"><span id="transformer-energy">0.00</span> <span class="unit">kWh</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">House111 (Board 2)</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="text-muted">Voltage</div>
                                            <div class="reading-value"><span id="admin-voltage">0.00</span> <span class="unit">V</span></div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-muted">Current</div>
                                            <div class="reading-value"><span id="admin-current">0.00</span> <span class="unit">A</span></div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <div class="text-muted">Power</div>
                                            <div class="reading-value"><span id="admin-power">0.00</span> <span class="unit">W</span></div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-muted">Energy</div>
                                            <div class="reading-value"><span id="admin-energy">0.00</span> <span class="unit">kWh</span></div>
                                        </div>
                                    </div>
                                    <div class="alert alert-warning mt-3">
                                        <div class="text-muted">Power Difference</div>
                                        <div class="reading-value"><span id="power-difference">0.00</span> <span class="unit">W</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Consumption Comparison</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="comparison-chart" height="100"></canvas>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="theft-log" role="tabpanel">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5 class="mb-0">Power Theft Incidents</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive theft-log">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Date & Time</th>
                                            <th>Transformer Power</th>
                                            <th>Consumer Power</th>
                                            <th>Difference</th>
                                        </tr>
                                    </thead>
                                    <tbody id="theft-log-body">
                                        <tr>
                                            <td>2023-11-05 14:32:15</td>
                                            <td>1250 W</td>
                                            <td>1450 W</td>
                                            <td>200 W</td>
                                        </tr>
                                        <tr>
                                            <td>2023-10-28 09:15:47</td>
                                            <td>1100 W</td>
                                            <td>1350 W</td>
                                            <td>250 W</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theft Alert -->
    <div id="theft-alert" class="alert-theft d-none">
        <div class="text-center">
            <h1><i class="fas fa-exclamation-triangle"></i> POWER THEFT DETECTED!</h1>
            <h3>Difference: <span id="alert-difference">0</span> W</h3>
            <p>Please investigate immediately</p>
            <button id="dismiss-alert" class="btn btn-light mt-3">Dismiss Alert</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDieP1yWZCYfw22llojBCY_rBk0vRwEH7k",
            authDomain: "iot-based-power-theft.firebaseapp.com",
            databaseURL: "https://iot-based-power-theft-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "iot-based-power-theft",
            storageBucket: "iot-based-power-theft.firebasestorage.app",
            messagingSenderId: "300681383944",
            appId: "1:300681383944:web:d9447408905b8afd6981bd"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const consumerDashboard = document.getElementById('consumer-dashboard');
        const adminDashboard = document.getElementById('admin-dashboard');
        const theftAlert = document.getElementById('theft-alert');
        
        // Login functionality
        document.getElementById('login-btn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'house111' && password === 'house111') {
                loginPage.classList.add('d-none');
                consumerDashboard.classList.remove('d-none');
                startConsumerDataFetch();
            } else if (username === 'admin111' && password === 'admin111') {
                loginPage.classList.add('d-none');
                adminDashboard.classList.remove('d-none');
                startAdminDataFetch();
            } else {
                alert('Invalid credentials. Please try again.');
            }
        });

        // Logout functionality
        document.getElementById('consumer-logout').addEventListener('click', function() {
            consumerDashboard.classList.add('d-none');
            loginPage.classList.remove('d-none');
        });

        document.getElementById('admin-logout').addEventListener('click', function() {
            adminDashboard.classList.add('d-none');
            loginPage.classList.remove('d-none');
        });

        // Dismiss theft alert
        document.getElementById('dismiss-alert').addEventListener('click', function() {
            theftAlert.classList.add('d-none');
        });

        // Bill calculation
        document.getElementById('calculate-bill').addEventListener('click', function() {
            document.getElementById('bill-details').classList.remove('d-none');
        });

        // Consumer data fetch
        function startConsumerDataFetch() {
            // Simulated data for demonstration
            setInterval(() => {
                const voltage = (220 + (Math.random() * 10 - 5)).toFixed(2);
                const current = (5 + (Math.random() * 3)).toFixed(2);
                const power = (voltage * current).toFixed(2);
                const energy = (125 + (Math.random() * 0.1)).toFixed(2);
                const frequency = (50 + (Math.random() * 0.2 - 0.1)).toFixed(2);
                const pf = (0.95 + (Math.random() * 0.05)).toFixed(2);
                
                document.getElementById('consumer-voltage').textContent = voltage;
                document.getElementById('consumer-current').textContent = current;
                document.getElementById('consumer-power').textContent = power;
                document.getElementById('consumer-energy').textContent = energy;
                document.getElementById('consumer-frequency').textContent = frequency;
                document.getElementById('consumer-pf').textContent = pf;
            }, 2000);
        }

        // Admin data fetch
        function startAdminDataFetch() {
            // Simulated data for demonstration
            setInterval(() => {
                // Transformer data
                const transVoltage = (230 + (Math.random() * 10 - 5)).toFixed(2);
                const transCurrent = (20 + (Math.random() * 5)).toFixed(2);
                const transPower = (transVoltage * transCurrent).toFixed(2);
                const transEnergy = (500 + (Math.random() * 0.5)).toFixed(2);
                
                document.getElementById('transformer-voltage').textContent = transVoltage;
                document.getElementById('transformer-current').textContent = transCurrent;
                document.getElementById('transformer-power').textContent = transPower;
                document.getElementById('transformer-energy').textContent = transEnergy;
                
                // Consumer data
                const consumerVoltage = (220 + (Math.random() * 10 - 5)).toFixed(2);
                const consumerCurrent = (18 + (Math.random() * 4)).toFixed(2);
                const consumerPower = (consumerVoltage * consumerCurrent).toFixed(2);
                const consumerEnergy = (450 + (Math.random() * 0.5)).toFixed(2);
                
                document.getElementById('admin-voltage').textContent = consumerVoltage;
                document.getElementById('admin-current').textContent = consumerCurrent;
                document.getElementById('admin-power').textContent = consumerPower;
                document.getElementById('admin-energy').textContent = consumerEnergy;
                
                // Calculate difference
                const powerDiff = Math.abs(transPower - consumerPower).toFixed(2);
                document.getElementById('power-difference').textContent = powerDiff;
                
                // Check for power theft
                if (powerDiff > 20) {
                    document.getElementById('alert-difference').textContent = powerDiff;
                    theftAlert.classList.remove('d-none');
                    
                    // Play alert sound
                    const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
                    audio.play();
                    
                    // Log theft incident
                    const now = new Date();
                    const dateTime = now.toLocaleString();
                    
                    const logEntry = `
                        <tr>
                            <td>${dateTime}</td>
                            <td>${transPower} W</td>
                            <td>${consumerPower} W</td>
                            <td>${powerDiff} W</td>
                        </tr>
                    `;
                    
                    document.getElementById('theft-log-body').innerHTML = logEntry + 
                        document.getElementById('theft-log-body').innerHTML;
                }
            }, 2000);
        }

        // Initialize charts
        const consumerCtx = document.getElementById('consumer-chart').getContext('2d');
        const consumerChart = new Chart(consumerCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'],
                datasets: [{
                    label: 'Energy Consumption (kWh)',
                    data: [120, 110, 95, 105, 115, 125, 135, 130, 120, 110, 95],
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Monthly Energy Consumption'
                    }
                }
            }
        });

        const comparisonCtx = document.getElementById('comparison-chart').getContext('2d');
        const comparisonChart = new Chart(comparisonCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'],
                datasets: [
                    {
                        label: 'Transformer (kWh)',
                        data: [500, 480, 510, 490, 520, 530, 540, 550, 530, 510, 500],
                        backgroundColor: 'rgba(54, 162, 235, 0.5)'
                    },
                    {
                        label: 'House111 (kWh)',
                        data: [120, 110, 95, 105, 115, 125, 135, 130, 120, 110, 95],
                        backgroundColor: 'rgba(255, 99, 132, 0.5)'
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Transformer vs Consumer Energy Comparison'
                    }
                }
            }
        });
    </script>
</body>
</html>
